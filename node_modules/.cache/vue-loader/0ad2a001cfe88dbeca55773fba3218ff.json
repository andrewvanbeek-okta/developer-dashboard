{"remainingRequest":"/Users/andrewvanbeek/opa-dev-dash/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/andrewvanbeek/opa-dev-dash/src/views/Opa.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/andrewvanbeek/opa-dev-dash/src/views/Opa.vue","mtime":1593691743569},{"path":"/Users/andrewvanbeek/opa-dev-dash/node_modules/css-loader/index.js","mtime":1592873612496},{"path":"/Users/andrewvanbeek/opa-dev-dash/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1592873617425},{"path":"/Users/andrewvanbeek/opa-dev-dash/node_modules/postcss-loader/src/index.js","mtime":1592873615483},{"path":"/Users/andrewvanbeek/opa-dev-dash/node_modules/vuetify-loader/lib/loader.js","mtime":1592873617526},{"path":"/Users/andrewvanbeek/opa-dev-dash/node_modules/cache-loader/dist/cjs.js","mtime":1592873611678},{"path":"/Users/andrewvanbeek/opa-dev-dash/node_modules/vue-loader/lib/index.js","mtime":1592873617424}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.scroll {\n  overflow-y: auto;\n  height: 600px;\n}\n",{"version":3,"sources":["Opa.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuUA;AACA;AACA;AACA","file":"Opa.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <v-row justify=\"center\">\n    <v-dialog v-model=\"dialog\" scrollable max-width=\"800px\">\n      <v-card>\n        <v-card-title>{{opaMessageTitle}}</v-card-title>\n        <v-card-text class=\"d-block pa-2 black white--text scroll\">{{opaResponse}}</v-card-text>\n        <v-btn color=\"blue darken-1\" text @click=\"dialog = false\">Close</v-btn>\n      </v-card>\n    </v-dialog>\n    <v-col cols=\"6\">\n      <v-card width=\"1000px\" scrollable=\"true\">\n        <v-card-title>Test Authorization</v-card-title>\n        <v-divider></v-divider>\n        <v-divider></v-divider>\n        <v-form>\n          <v-container>\n            <v-row>\n              <v-col cols=\"12\" md=\"4\">\n                <v-text-field v-model=\"method\"></v-text-field>\n              </v-col>\n\n              <v-col cols=\"12\" md=\"4\">\n                <v-text-field v-model=\"path\"></v-text-field>\n              </v-col>\n            </v-row>\n            <v-row>\n              <v-col cols=\"9\">\n                <v-label>Copy and Paste your Access Token</v-label>   <v-btn color=\"blue darken-1\" text @click=\"parseJwt()\">Show Token Contents</v-btn>\n                <v-textarea\n                  outlined\n                  name=\"input-7-4\"\n                  label=\"Paste a Access Token here\"\n                  rows=\"12\"\n                  v-model=\"access_token\"\n                ></v-textarea>\n              </v-col>\n              <v-col cols=\"3\">\n                <v-label>Use the token from the Dev Dashboard</v-label>\n                <v-switch value v-model=\"useCurrentToken\"></v-switch>\n              </v-col>\n            </v-row>\n          </v-container>\n          <v-row justify=\"center\">\n            <v-btn color=\"primary\" dark class=\"mb-2 send\" @click=\"sendToOpa()\">Send</v-btn>\n          </v-row>\n        </v-form>\n        <div class=\"d-block pa-2 black white--text scroll\">\n          What we are going to send to Open Policy Agent\n          <br />\n          <br />\n          {\n          \"input\":{\n          \"method\": \"{{method}}\",\n          \"path\": \"{{path}}\",\n          \"token\": \"{{access_token}}\"\n          }\n          }\n        </div>\n        <v-divider></v-divider>\n      </v-card>\n    </v-col>\n    <v-col cols=\"6\">\n      <v-card width=\"1000px\" scrollable=\"true\">\n        <v-card-title>\n          Open Policy Agent Status:\n          <span v-if=\"opaOff\">\n            Not Available\n            <v-btn icon @click=\"opaInfo()\">\n              <v-icon>?</v-icon>\n            </v-btn>\n          </span>\n          <span v-else>All systems go</span>\n        </v-card-title>\n        <v-progress-linear v-if=\"opaOff\" color=\"red lighten-2\" buffer-value=\"0\" stream></v-progress-linear>\n        <v-progress-linear color=\"green\" buffer-value=\"0\" value=\"100\" stream v-else></v-progress-linear>\n        <v-divider></v-divider>\n        <v-card-title>Edit Opa Policy</v-card-title>\n        <v-divider></v-divider>\n        <v-card-text>\n          <v-form>\n            <v-container>\n              <v-row>\n                <v-col cols=\"12\" md=\"2\">\n                  <v-label>Check Token for scope below</v-label>\n                  <v-switch v-model=\"checkForScope\" value=\"John\"></v-switch>\n                  <v-text-field placeholder=\"scope value\" v-model=\"scopeToCheck\"></v-text-field>\n                </v-col>\n                <v-col cols=\"12\" md=\"2\">\n                  <v-label>Check Token for claim below</v-label>\n                  <v-switch v-model=\"checkForClaim\" value></v-switch>\n                   <v-text-field placeholder=\"claim title\" v-model=\"claimKey\"></v-text-field>\n                  <v-text-field placeholder=\"claim value\" v-model=\"claimToCheck\"></v-text-field>\n                </v-col>\n                <v-col cols=\"12\" md=\"2\">\n                  <v-label>Check Token for role or group name</v-label>\n                  <v-switch v-model=\"checkForGroup\" value=\"John\"></v-switch>\n                  <v-text-field placeholder=\"role value\" v-model=\"groupForCheck\"></v-text-field>\n                </v-col>\n                <v-col cols=\"12\" md=\"2\">\n                  <v-label>Check Token for specific users</v-label>\n                  <v-switch v-model=\"checkForUser\" value=\"John\"></v-switch>\n                  <v-text-field placeholder=\"username value\" v-model=\"userForCheck\"></v-text-field>\n                </v-col>\n              </v-row>\n            </v-container>\n            <v-row justify=\"center\">\n              <v-btn color=\"primary\" dark class=\"mb-2 send\" @click=\"easyAuthorization()\">Apply</v-btn>\n            </v-row>\n          </v-form>\n        </v-card-text>\n         <v-label>Or Directly edit the OPA policy</v-label>\n        <div class=\"d-block pa-2 black white--text scroll\">\n          <!-- <h3>Run command below</h3>\n          <p v-for=\"fragment in regoFragements\">{{fragment}}<br></p>-->\n          <editor-content :editor=\"editor\" />\n        </div>\n        <v-divider></v-divider>\n        <v-card-actions>\n          <v-btn color=\"blue darken-1\" text @click=\"saveRego()\">Save</v-btn>\n          <v-btn color=\"blue darken-1\" text @click=\"resetRego()\">Reset</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-col>\n  </v-row>\n</template>\n\n<script>\nimport { Editor, EditorContent } from \"tiptap\";\nexport default {\n  components: {\n    EditorContent\n  },\n  client_name: \"Developer\",\n  data: () => ({\n    opaText: \"\",\n    on: true,\n    useCurrentToken: false,\n    opaMessageTitle: \"\",\n    checkForClaim: false,\n    claimKey: \"placeholder\",\n    claimToCheck: \"\",\n    checkForScope: false,\n    scopeToCheck: \"\",\n    checkForGroup: false,\n    groupForCheck: \"\",\n    checkForUser: false,\n    userForCheck: \"\",\n    opaOff: false,\n    opaResponse: \"\",\n    dialog: false,\n    method: \"GET\",\n    path: \"finance\",\n    access_token: \"\",\n    editor: null,\n    regoFragements: [],\n    user: \"\"\n  }),\n\n  computed: {\n    formTitle() {\n      return this.editedIndex === -1 ? \"New Oauth App\" : \"View Oauth Client\";\n    }\n  },\n\n  watch: {\n    dialog(val) {\n      val || this.close();\n    },\n    async useCurrentToken(newValue) {\n      var useDashToken = this.useCurrentTokens;\n      if (newValue) {\n        this.access_token = await this.$auth.getAccessToken();\n      } else {\n        this.access_token = \"\";\n      }\n    }\n  },\n\n  created() {\n    this.initialize();\n    console.log(process.env.VUE_APP_OKTA_ISSUER);\n    this.okta_issuer = process.env.VUE_APP_OKTA_ISSUER;\n  },\n\n  methods: {\n    async initialize() {\n      var component = this;\n      var user = await this.$auth.getUser();\n      var accessToken = await this.$auth.getAccessToken();\n      const accessTokenobj = {\n        accessToken\n      };\n      this.user = user.preferred_username;\n      const baseURI = \"http://localhost:8000/opa\";\n      var opa = await this.$http.get(baseURI);\n      if (opa.data.name) {\n        this.opaOff = opa.data.name.code == \"ECONNREFUSED\";\n        this.opaInfo();\n      }\n      this.regoFragements = opa.data.rego.split(\"\\n\");\n      var rego = opa.data.rego.split(\"\\n\").join(\"</br>\");\n      var niceRego = this.createPrettyString(this.regoFragements);\n      this.editor = new Editor({\n        content: niceRego\n      });\n      component.saveRego();\n    },\n    opaInfo() {\n      if (this.opaOff) {\n        this.opaMessageTitle =\n          \"You do not have Open Policy Agent running.  Run this command in the terminal and refresh the page(prereq is to have docker)\";\n        this.opaResponse =\n          \"docker run -p 8181:8181 openpolicyagent/opa \\\n    run --server --log-level debug\";\n        this.dialog = true;\n      }\n    },\n    async saveRego() {\n      const baseURI = \"http://localhost:8000/rego\";\n      var jsonContent = this.editor.getJSON();\n      var htmlContent = this.editor.getHTML();\n      console.log(jsonContent.content);\n      var regoToSend = this.createFormattedString(jsonContent.content);\n      console.log(regoToSend);\n      var opa = await this.$http.post(baseURI, { rego: regoToSend });\n      console.log(opa);\n    },\n    parseJwt() {\n      var base64Url = this.access_token.split(\".\")[1];\n      var base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\");\n      var jsonPayload = decodeURIComponent(\n        atob(base64)\n          .split(\"\")\n          .map(function(c) {\n            return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n          })\n          .join(\"\")\n      );\n      this.opaMessageTitle = \"Parsed Access Token\"\n      this.opaResponse = JSON.parse(jsonPayload);\n      this.dialog = true\n    },\n    async easyAuthorization() {\n      var component = this;\n      const baseURI = \"http://localhost:8000/easyRego\";\n      var opa = await this.$http.get(baseURI);\n      this.regoFragements = opa.data.rego.split(\"\\n\");\n      var rego = opa.data.rego.split(\"\\n\").join(\"</br>\");\n      var niceRego = this.createPrettyString(this.regoFragements);\n      var regoWithSettings = this.easyAuthorizationSettings(niceRego);\n      this.editor.setContent(regoWithSettings);\n      this.saveRego();\n    },\n    easyAuthorizationSettings(rego) {\n      var regoSettingsString = \"\";\n      if (this.checkForClaim) {\n        regoSettingsString += \"<p>\" + \"user_owns_claim\" + \"</p></br>\";\n        rego.replace(\"#claim#\", this.claimToCheck);\n      }\n      if (this.checkForScope) {\n        regoSettingsString += \"<p>\" + \"user_owns_scope\" + \"</p></br>\";\n        rego.replace(\"#scope#\", this.scopeToCheck);\n      }\n      if (this.checkForGroup) {\n        regoSettingsString += \"<p>\" + \"user_owns_role\" + \"</p></br>\";\n      }\n      if (this.checkForUser) {\n        regoSettingsString += \"<p>\" + \"user_owns_username\" + \"</p></br>\";\n      }\n      var newRego = rego\n        .replace(\"#placeholder#\", regoSettingsString)\n        .replace(\"#username#\", this.userForCheck)\n        .replace(\"#role#\", this.groupForCheck)\n        .replace(\"#scope#\", this.scopeToCheck)\n        .replace(\"#claim#\", this.claimToCheck)\n        .replace(\"_replace_claim_key\", this.claimKey);\n      return newRego;\n    },\n    async sendToOpa() {\n      var component = this;\n      const baseURI = \"http://localhost:8000/opaAuthz\";\n      var opa = await this.$http.post(baseURI, {\n        method: component.method,\n        path: component.path,\n        token: component.access_token\n      });\n      console.log(opa);\n      component.opaMessageTitle = \"Response from Opa!\";\n      component.opaResponse = opa.data;\n      component.dialog = true;\n    },\n    async resetRego() {\n      const baseURI = \"http://localhost:8000/rego\";\n      var opa = await this.$http.delete(baseURI);\n      this.$router.go();\n    },\n    createPrettyString(fragments) {\n      var string = \"\";\n      fragments.forEach((item, i) => {\n        string += \"<p>\" + item + \"</p><br>\";\n      });\n      return string;\n    },\n    createFormattedString(contentObjects) {\n      var string = \"\";\n      contentObjects.forEach((item, i) => {\n        if (item.content) {\n          string += item.content[0].text + \"\\n\";\n          if (item.content[0].text.includes(\"}\")) {\n            string += \"\\n\";\n          }\n        }\n      });\n      return string;\n    },\n    async logout() {\n      await this.$auth.logout();\n      await this.$auth.isAuthenticated();\n\n      // Navigate back to home\n      window.location.reload();\n    }\n  }\n};\n</script>\n \n<style>\n.scroll {\n  overflow-y: auto;\n  height: 600px;\n}\n</style>\n"]}]}